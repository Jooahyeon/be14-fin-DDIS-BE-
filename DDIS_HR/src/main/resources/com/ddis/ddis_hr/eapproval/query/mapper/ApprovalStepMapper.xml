<!--<?xml version="1.0" encoding="UTF-8"?>-->
<!--<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"-->
<!--        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">-->

<!--<mapper namespace="com.ddis.ddis_hr.eapproval.query.mapper.ApprovalStepMapper">-->

<!--    &lt;!&ndash; 결재 단계 매핑: 결재 단계(step)와 직급명(rank_name)을 DTO에 매핑 &ndash;&gt;-->
<!--    <resultMap id="ApprovalStepMap" type="com.ddis.ddis_hr.eapproval.query.dto.ApprovalStepQueryDTO">-->
<!--        <result property="step" column="step"/>-->
<!--        <result property="rank" column="rank_name"/>-->
<!--    </resultMap>-->

<!--    &lt;!&ndash;-->
<!--        기안자의 직급 순서(baseRankOrder)를 기준으로 상위 직급을 조회하여 결재 단계를 구성함-->
<!--        예: 과장(rank_order=3)이 기안 시, 그보다 높은 부장(4), 상무(5), 사장(6) 등이 결재 대상이 됨-->
<!--    &ndash;&gt;-->
<!--    <select id="findApprovalStepsByBaseRankOrder"-->
<!--            resultMap="ApprovalStepMap"-->
<!--            parameterType="int">-->
<!--        SELECT-->
<!--            ROW_NUMBER() OVER (ORDER BY rank_order) AS step,-->
<!--            rank_name-->
<!--        FROM rank-->
<!--        WHERE rank_order > #{baseRankOrder}-->
<!--        ORDER BY rank_order ASC-->
<!--    </select>-->

<!--    &lt;!&ndash;-->
<!--        조직 범위(팀, 부서, 본부)와 직급명을 기반으로 해당 조건에 맞는 결재자 1명을 조회-->
<!--        기안자의 조직 정보를 기준으로 결재자를 자동 매칭함-->
<!--    &ndash;&gt;-->
<!--    <select id="findApproverByRankAndOrg"-->
<!--            resultType="com.ddis.ddis_hr.eapproval.query.dto.ApproverInfoQueryDTO">-->
<!--        SELECT-->
<!--        e.employee_id AS employeeId,-->
<!--        e.rank_id AS rankId,-->
<!--        e.employee_name AS name-->
<!--        FROM employee e-->
<!--        JOIN rank r ON e.rank_id = r.rank_id-->
<!--        WHERE r.rank_name = #{rankName}-->
<!--        <choose>-->
<!--            <when test="organizationType == 'team'">-->
<!--                AND e.team_id = #{organizationId}-->
<!--            </when>-->
<!--            <when test="organizationType == 'department'">-->
<!--                AND e.department_id = #{organizationId}-->
<!--            </when>-->
<!--            <when test="organizationType == 'head'">-->
<!--                AND e.head_id = #{organizationId}-->
<!--            </when>-->
<!--        </choose>-->
<!--        LIMIT 1-->
<!--    </select>-->

<!--    &lt;!&ndash; 팀 단위에서 직급 기준으로 결재자 조회 &ndash;&gt;-->
<!--    <select id="findApproverByTeamAndRank"-->
<!--            resultType="com.ddis.ddis_hr.eapproval.query.dto.ApproverInfoQueryDTO">-->
<!--        SELECT-->
<!--            e.employee_id   AS employeeId,-->
<!--            e.employee_name AS employeeName,-->
<!--            r.rank_id       AS rankId-->
<!--        FROM employee e-->
<!--                 JOIN rank r ON e.rank_id = r.rank_id-->
<!--        WHERE r.rank_name = #{rankName}-->
<!--          AND e.team_id = #{teamId}-->
<!--        LIMIT 1-->
<!--    </select>-->

<!--    &lt;!&ndash; 부서 단위에서 직급 기준으로 결재자 조회 &ndash;&gt;-->
<!--    <select id="findApproverByDepartmentAndRank"-->
<!--            resultType="com.ddis.ddis_hr.eapproval.query.dto.ApproverInfoQueryDTO">-->
<!--        SELECT-->
<!--            e.employee_id   AS employeeId,-->
<!--            e.employee_name AS employeeName,-->
<!--            r.rank_id       AS rankId-->
<!--        FROM employee e-->
<!--                 JOIN rank r ON e.rank_id = r.rank_id-->
<!--        WHERE r.rank_name = #{rankName}-->
<!--          AND e.department_id = #{departmentId}-->
<!--        LIMIT 1-->
<!--    </select>-->

<!--    &lt;!&ndash; 본부 단위에서 직급 기준으로 결재자 조회 &ndash;&gt;-->
<!--    <select id="findApproverByHeadAndRank"-->
<!--            resultType="com.ddis.ddis_hr.eapproval.query.dto.ApproverInfoQueryDTO">-->
<!--        SELECT-->
<!--            e.employee_id   AS employeeId,-->
<!--            e.employee_name AS employeeName,-->
<!--            r.rank_id       AS rankId-->
<!--        FROM employee e-->
<!--                 JOIN rank r ON e.rank_id = r.rank_id-->
<!--        WHERE r.rank_name = #{rankName}-->
<!--          AND e.head_id = #{headId}-->
<!--        LIMIT 1-->
<!--    </select>-->

<!--</mapper>-->
